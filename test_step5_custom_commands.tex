\documentclass[12pt,a4paper]{article}
\usepackage{polyglossia}
\usepackage{fontspec}
\usepackage{bidi}

% --- Document Setup ---
\setdefaultlanguage{english}
\setotherlanguage{farsi}

% --- Font Setup ---
\newfontfamily\arabicfont{DejaVu Sans}
\newfontfamily\englishfont{DejaVu Sans}

% --- Custom Commands - Test the problematic \persian command ---
\newcommand{\persian}[1]{\textfarsi{#1}}
\newcommand{\eng}[1]{\textenglish{#1}}

\begin{document}

\section*{Test Step 5: Custom Commands}

\eng{This is English text using custom command.}

\persian{این متن فارسی با دستور سفارشی است.}

Direct commands work: \textfarsi{متن مستقیم فارسی}

\end{document}
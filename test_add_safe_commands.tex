\documentclass[12pt,a4paper]{article}
\usepackage{polyglossia}
\usepackage{fontspec}
\usepackage{geometry}
\usepackage{amsmath}

% --- Document Setup ---
\geometry{a4paper, margin=1in}
\setdefaultlanguage{english}
\setotherlanguage{farsi}

% --- Font Setup ---
\newfontfamily\arabicfont{DejaVu Sans}

% --- Safe Custom Commands ---
\newcommand{\fa}[1]{\textfarsi{#1}}
\newcommand{\en}[1]{\textenglish{#1}}

\begin{document}

\section*{Test: Safe Custom Commands}

\en{English text using custom command.}

\fa{متن فارسی با دستور سفارشی.}

Math works: $\fa{ریاضی:} \sum_{i=1}^n i = \frac{n(n+1)}{2}$

\begin{equation}
\fa{معادله:} \quad E = mc^2
\end{equation}

\end{document}